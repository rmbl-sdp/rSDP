<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rSDP">
<title>Wrangling Spatial Data • rSDP</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Wrangling Spatial Data">
<meta property="og:description" content="rSDP">
<meta property="og:image" content="https://rmbl-sdp.github.io/rSDP/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rSDP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-resources">Resources</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-resources">
    <h6 class="dropdown-header" data-toc-skip>Tutorials</h6>
    <a class="dropdown-item" href="../articles/sdp-cloud-data.html">Connecting to SDP Datasets</a>
    <a class="dropdown-item" href="../articles/field-site-sampling.html">Extracting SDP Data Field Sites</a>
    <a class="dropdown-item" href="../articles/pretty-maps.html">Creating Figures from Raster Data</a>
    <a class="dropdown-item" href="../articles/wrangle-raster-data.html">Wrangling Spatial Datasets</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>SDP Dataset Catalog</h6>
    <a class="external-link dropdown-item" href="https://www.rmbl.org/scientists/resources/data-catalog/?tag-id=84">All SDP Datasets</a>
    <a class="external-link dropdown-item" href="https://www.rmbl.org/scientists/resources/data-catalog/?tag-id=326">Release One</a>
    <a class="external-link dropdown-item" href="https://www.rmbl.org/scientists/resources/data-catalog/?tag-id=327">Release Two</a>
    <a class="external-link dropdown-item" href="https://www.rmbl.org/scientists/resources/data-catalog/?tag-id=328">Release Three</a>
    <a class="external-link dropdown-item" href="https://www.rmbl.org/scientists/resources/data-catalog/?tag-id=325">Release Four</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rmbl-sdp/rSDP/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Wrangling Spatial Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rmbl-sdp/rSDP/blob/HEAD/vignettes/wrangle-raster-data.Rmd" class="external-link"><code>vignettes/wrangle-raster-data.Rmd</code></a></small>
      <div class="d-none name"><code>wrangle-raster-data.Rmd</code></div>
    </div>

    
    
<p><em>by <a href="ikb@rmbl.org">Ian Breckheimer</a>, updated 14 March
2023.</em></p>
<p>Getting spatial data into the right shape and format for analysis
(“data wrangling”) comes with some unique challenges relative to
tabular, spreadsheet-style data. Spatial data comes in a variety of
formats, can have complex structure. It’s also sometimes very large
(Gigabytes or more)! Luckly, R comes with a mature set of tools for
wrangling spatial data.</p>
<div class="figure">
<img src="https://rzine.fr/publication/20210204_learnr_dplyr_allison_horst/featured_hu565622b82dee564ffeba1cec01107210_807144_720x0_resize_lanczos_3.png" alt="Data wrangling illustration by Allison Horst." width="100%"><p class="caption">
Data wrangling illustration by Allison Horst.
</p>
</div>
<p>This Vignette covers some common workflows encountered in the
wrangling process. Note that although we use data from the RMBL Spatial
Data Platform (accessed using the <code>rSDP</code> package), these
basic workflows apply whenever you are dealing with spatial data in R
from any source.</p>
<div class="section level2">
<h2 id="vector-vs-raster-data-">Vector vs raster data.<a class="anchor" aria-label="anchor" href="#vector-vs-raster-data-"></a>
</h2>
<p>The most fundamental distinction in spatial data is between
<em>vector-formatted data</em> (points, lines, polygons), and
<em>raster-formatted data</em> (images, arrays, grids).</p>
<ul>
<li>Vector data is usually used to represent data that is sparse in
space (say, points representing research sites, or polygons representing
watersheds).</li>
<li>Raster data structures are typically used when we have measurements
at a regular spacing, such as the pixels of a satellite image or of an
elevation map.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html" class="external-link">include_graphics</a></span><span class="op">(</span><span class="st">"https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/Raster_vector_tikz.png/744px-Raster_vector_tikz.png"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/Raster_vector_tikz.png/744px-Raster_vector_tikz.png" alt="Figure 2. Raster vs vector data. Graphic by [Wegmann](https://commons.wikimedia.org/wiki/File:Raster_vector_tikz.png)" width="100%"><p class="caption">
Figure 2. Raster vs vector data. Graphic by <a href="https://commons.wikimedia.org/wiki/File:Raster_vector_tikz.png" class="external-link">Wegmann</a>
</p>
</div>
<p>This distinction between raster and vector data is important because
these two data types have different ecosystems of packages and functions
that can work with them:</p>
<ul>
<li><p>The most widely-used package for reading and working with vector
data is <code>sf</code> (Pebesma et al. 2018). This package provides a
large number of functions for wrangling points, lines, and polygons,
including basic geometric operations like buffering, and spatial
joins.</p></li>
<li><p>The go-to package for wrangling raster data is <code>terra</code>
(Hijmans et al. 2020), which provides efficient functions for common
raster operations like cropping, and resampling. There are a few
vector-data-focused functions in <code>terra</code>, but most of these
are mirrored by functions also available in <code>sf</code>.</p></li>
</ul>
<p>Note that these are not the only packages for wrangling spatial data
in the <code>R</code> ecosystem (see <a href="https://cran.r-project.org/web/views/Spatial.html" class="external-link">here</a> for a
more comprehensive vew), but we have found that we can usually
accomplish almost everything we need to using these two.</p>
</div>
<div class="section level2">
<h2 id="setting-up-the-workspace-and-dealing-with-dependencies-">Setting up the workspace and dealing with dependencies.<a class="anchor" aria-label="anchor" href="#setting-up-the-workspace-and-dealing-with-dependencies-"></a>
</h2>
<p>If you can get the <code>terra</code> and <code>sf</code> packages
installed and successfully loaded on your computer you are well on your
way. On Mac and Windows systems, this is usually as simple as:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"terra"</span>,<span class="st">"sf"</span><span class="op">)</span>,type<span class="op">=</span><span class="st">"binary"</span><span class="op">)</span></span></code></pre></div>
<p>We specify <code>type="binary"</code> to avoid common problems with
compiling these packages that rely on external libraries. Unfortunately,
things are not quite as easy on Linux machines for which binary versions
of the source packages are not available. In that case, you should
follow the <a href="https://rtask.thinkr.fr/installation-of-r-4-2-on-ubuntu-22-04-lts-and-tips-for-spatial-packages/#Install_packages_for_spatial_data_analyses_in_Ubuntu" class="external-link">instructions
here</a> to install these external libraries <em>before</em> installing
<code>terra</code> and <code>sf</code>.</p>
<p>The rSDP package is not up on CRAN yet, so you will need to install
the latest version from GitHub.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"rmbl-sdp/rSDP"</span><span class="op">)</span></span></code></pre></div>
<p>Once you’ve got everything installed, you can load the libraries into
your R workspace:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rmbl-sdp/rSDP" class="external-link">rSDP</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reading-in-raster-and-vector-data-">Reading in raster and vector data.<a class="anchor" aria-label="anchor" href="#reading-in-raster-and-vector-data-"></a>
</h2>
<div class="section level3">
<h3 id="reading-in-vector-data">Reading in vector data<a class="anchor" aria-label="anchor" href="#reading-in-vector-data"></a>
</h3>
<p>Vector spatial data comes in a large variety of formats, but nearly
all of the common ones can be read in using the <code>sf</code> function
<code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read()</a></code>. Behind the scenes, <code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read()</a></code> relies
on the fantastic <a href="https://gdal.org/" class="external-link"><code>GDAL</code>
library</a> for this. If it’s in <a href="https://gdal.org/drivers/vector/index.html" class="external-link">a format GDAL can
read</a>, you can get it into R with <code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read()</a></code>.</p>
<p>Of all the possibilities, two vector formats stand out for being
open-source and broadly readable:</p>
<ul>
<li>geoJSON, an open plain-text data <a href="https://en.wikipedia.org/wiki/GeoJSON" class="external-link">format</a> that works
really well for small to medium-sized datasets (up to a few hundred
MB).</li>
<li>GeoPackage, an open geospatial database <a href="https://www.geopackage.org/" class="external-link">format</a> based on SQLITE that can
efficiently store larger and more complex datasets than geoJSON,
including related tables and layers with multiple geometry types.</li>
</ul>
<p>In this example, we will read a small geoJSON file from the web
representing hypothetical research sites in the vicinity of Rocky
Mountain Biological Laboratory. One of the nice things about the geoJSON
format is that it can be read from a web-based source directly into
R:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">"https://rmbl-sdp.s3.us-east-2.amazonaws.com/data_products/supplemental/rSDP_example_points_latlon.geojson"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading layer `rSDP_example_points_latlon' from data source </span></span>
<span><span class="co">#&gt;   `https://rmbl-sdp.s3.us-east-2.amazonaws.com/data_products/supplemental/rSDP_example_points_latlon.geojson' </span></span>
<span><span class="co">#&gt;   using driver `GeoJSON'</span></span>
<span><span class="co">#&gt; Simple feature collection with 9 features and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -106.9934 ymin: 38.95576 xmax: -106.9839 ymax: 38.96237</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span></code></pre></div>
<p>This would also work if you first downloaded the file. You would just
need to replace the URL with the file path on your computer.</p>
<p>The structure of an <code>sf</code> vector dataset extends the basic
structure of an <code>R</code> data frame, with the addition of a
<code>geometry</code> column that holds information about the points,
lines, or polygons associated with each feature. Attributes of each
feature (the “Attribute Table”) are stored the same way as other tabular
datasets in R.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sites</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -106.9934 ymin: 38.95807 xmax: -106.9898 ymax: 38.96237</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;   fid         Name                   geometry</span></span>
<span><span class="co">#&gt; 1   1        Rocky POINT (-106.9904 38.96237)</span></span>
<span><span class="co">#&gt; 2   2        Aspen POINT (-106.9898 38.96222)</span></span>
<span><span class="co">#&gt; 3   3         Road POINT (-106.9903 38.96083)</span></span>
<span><span class="co">#&gt; 4   4   BeaverPond POINT (-106.9934 38.96006)</span></span>
<span><span class="co">#&gt; 5   5 GrassyMeadow POINT (-106.9927 38.96023)</span></span>
<span><span class="co">#&gt; 6   6      Conifer  POINT (-106.992 38.95807)</span></span></code></pre></div>
<p>The upshot is that you can use all the tools available for wrangling
data frames (subsetting, filtering, reshaping, etc.) on sf objects
without trouble. For most operations, the <code>geometry</code> column
is <em>sticky</em>, which means that it is carried forward when new
derived datasets are created. For example, if we wanted to create a new
dataset containing only the <code>Name</code> column in
<code>sites</code> we could use the standard subsetting syntax to select
all the rows and the second column:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sites_name</span> <span class="op">&lt;-</span> <span class="va">sites</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">sites_name</span></span>
<span><span class="co">#&gt; Simple feature collection with 9 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -106.9934 ymin: 38.95576 xmax: -106.9839 ymax: 38.96237</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;             Name                   geometry</span></span>
<span><span class="co">#&gt; 1          Rocky POINT (-106.9904 38.96237)</span></span>
<span><span class="co">#&gt; 2          Aspen POINT (-106.9898 38.96222)</span></span>
<span><span class="co">#&gt; 3           Road POINT (-106.9903 38.96083)</span></span>
<span><span class="co">#&gt; 4     BeaverPond POINT (-106.9934 38.96006)</span></span>
<span><span class="co">#&gt; 5   GrassyMeadow POINT (-106.9927 38.96023)</span></span>
<span><span class="co">#&gt; 6        Conifer  POINT (-106.992 38.95807)</span></span>
<span><span class="co">#&gt; 7 WeatherStation POINT (-106.9859 38.95641)</span></span>
<span><span class="co">#&gt; 8        Smelter POINT (-106.9839 38.95576)</span></span>
<span><span class="co">#&gt; 9     Roundabout  POINT (-106.988 38.95808)</span></span></code></pre></div>
<p>We didn’t specify bringing the <code>geometry</code> column with us,
but since it’s <em>sticky</em> it came along for the ride.</p>
</div>
<div class="section level3">
<h3 id="reading-in-raster-data">Reading in raster data<a class="anchor" aria-label="anchor" href="#reading-in-raster-data"></a>
</h3>
<p>We can use a similar pattern to get an example raster dataset into R.
Here we will use the <code><a href="../reference/sdp_get_raster.html">sdp_get_raster()</a></code> function to read in a
raster dataset representing the ground elevation above sea level,
commonly called a Digital Elevation Model or DEM.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdp_get_raster.html">sdp_get_raster</a></span><span class="op">(</span><span class="st">"R3D009"</span><span class="op">)</span></span>
<span><span class="va">dem</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 24201, 27668, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 3, 3  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 305082, 388086, 4256064, 4328667  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : WGS 84 / UTM zone 13N (EPSG:32613) </span></span>
<span><span class="co">#&gt; source      : UG_dem_3m_v1.tif </span></span>
<span><span class="co">#&gt; name        : UG_dem_3m_v1</span></span></code></pre></div>
<p>One notable difference with the call to <code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read()</a></code> is
that by default <code><a href="../reference/sdp_get_raster.html">sdp_get_raster()</a></code> doesn’t download the full
dataset locally, just the file header with basic information. The
Vignette “Accessing Cloud-based Datasets” provides more detail on
accessing raster data using the rSDP package.</p>
</div>
</div>
<div class="section level2">
<h2 id="re-projecting-vector-data">Re-projecting vector data<a class="anchor" aria-label="anchor" href="#re-projecting-vector-data"></a>
</h2>
<p>One of the complexities of geographic data is that maps (and the data
that make them up) are generally 2-dimensional, while the earth is a <a href="https://en.wikipedia.org/wiki/Geoid" class="external-link">surprisingly lumpy</a> 3-D
object. The upshot is there are a variety of 2-D <a href="https://mgimond.github.io/Spatial/chp09_0.html" class="external-link">coordinate
systems</a> that describe locations and geographic relationships. Each
coordinate system system has different strengths and weaknesses, which
means that data collected for different purposes or in different places
often use different systems.</p>
<p>In this example, the point data we read in earlier uses a Geographic
(Geodetic) Coordinate System that defines locations using latitude and
longitude. You can verify this by looking at the last line of the
information printed when we read the data in. The line
<code>Geodetic CRS: WGS 84</code> means that this data has coordinates
stored in the most common lat-lon coordinate system, the <a href="https://en.wikipedia.org/wiki/World_Geodetic_System" class="external-link">World
Geodetic System</a> (WGS) agreed to in the year 1984. Among other
reasons, this coordinate system is popular because it is the one used by
GPS and other satellite navigation systems.</p>
<p>In contrast, the raster data is in another coordinate system, called
Universal Transverse Mercator or (UTM). This is a “projected” coordinate
system where the X and Y coordinates represent the distance in meters
from an arbitrary start location (often called a <em>datum</em>).</p>
<div class="figure">
<img src="geographic_vs_projected.png" alt="Figure 2. Geographic vs projected coordinate systems. A geographic system (left) uses angular coordinates (latitude and longitude) describing position on the 3D surface of the earth. A projected system (right) 'flattens' the globe and measures coordinates from an arbitrary origin or datum, represented in the right figure by a blue circle. Modified from [Lovelace et al. 2019](https://doi.org/10.1201/9780203730058)." width="100%"><p class="caption">
Figure 2. Geographic vs projected coordinate systems. A geographic
system (left) uses angular coordinates (latitude and longitude)
describing position on the 3D surface of the earth. A projected system
(right) ‘flattens’ the globe and measures coordinates from an arbitrary
origin or datum, represented in the right figure by a blue circle.
Modified from <a href="https://doi.org/10.1201/9780203730058" class="external-link">Lovelace
et al. 2019</a>.
</p>
</div>
<p>The <code>crs</code> function in the <code>terra</code> package can
retrieve the coordinate reference system of <code>terra</code> and
<code>sf</code> objects. Here, we verify that the coordinate systems of
the two datasets are different:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">sites</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "GEOGCRS[\"WGS 84\",\n    DATUM[\"World Geodetic System 1984\",\n        ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    CS[ellipsoidal,2],\n        AXIS[\"geodetic latitude (Lat)\",north,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        AXIS[\"geodetic longitude (Lon)\",east,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n    ID[\"EPSG\",4326]]"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">sites</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>This means that if we want to do any kind of data wrangling operation
that involves both datasets, we will need to get them in the same
coordinate system. Translating data from one coordinate system to
another is called <em>projection</em>. Hypothetically, we could
either:</p>
<ul>
<li>Project the raster dataset to the same coordinate system as the
vector <em>or</em>
</li>
<li>Project the vector dataset to the same coordinate system as the
raster</li>
</ul>
<p>In practice, it’s usually a better idea to re-project the vector
data. This is almost always a much faster operation. Moreover, unlike
when we re-project vector datasets, re-projecting a raster results in a
slight loss of information. Here we re-project the point data to the
same coordinate system as the raster:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sites_proj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">sites</span>,crs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">dem</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">sites_proj</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sites_proj</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 327280.5 ymin: 4314011 xmax: 327598 ymax: 4314484</span></span>
<span><span class="co">#&gt; Projected CRS: WGS 84 / UTM zone 13N</span></span>
<span><span class="co">#&gt;   fid         Name                 geometry</span></span>
<span><span class="co">#&gt; 1   1        Rocky POINT (327549.7 4314484)</span></span>
<span><span class="co">#&gt; 2   2        Aspen   POINT (327598 4314467)</span></span>
<span><span class="co">#&gt; 3   3         Road POINT (327550.8 4314314)</span></span>
<span><span class="co">#&gt; 4   4   BeaverPond POINT (327280.5 4314235)</span></span>
<span><span class="co">#&gt; 5   5 GrassyMeadow POINT (327342.2 4314252)</span></span>
<span><span class="co">#&gt; 6   6      Conifer POINT (327403.2 4314011)</span></span></code></pre></div>
<p>You can see the values of the coordinates in <code>sites_proj</code>
are different from the original object <code>sites</code>, and the
coordinate systems are now identical between the raster and vector data.
This is success! It means we are ready to use both datasets
together.</p>
<div class="section level3">
<h3 id="a-basic-plot">A basic plot<a class="anchor" aria-label="anchor" href="#a-basic-plot"></a>
</h3>
<p>To confirm that we were successful at getting the two datasets in the
same coordinate system, we can plot them.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dem</span>,main<span class="op">=</span><span class="st">"Elevation (m)"</span>,ext<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">sites_proj</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">sites_proj</span><span class="op">)</span></span></code></pre></div>
<p><img src="wrangle-raster-data_files/figure-html/rast%20plot-1.png" width="50%"></p>
<p>In the code above, specifying the argument <code>ext</code> plots a
spatial subset of the raster dataset. We specify the subset by calling
the <code><a href="https://rdrr.io/pkg/terra/man/ext.html" class="external-link">ext()</a></code> function, which returns a rectangular region
covered by the point dataset.</p>
</div>
</div>
<div class="section level2">
<h2 id="cropping-rasters-to-an-area-of-interest-">Cropping rasters to an area of interest.<a class="anchor" aria-label="anchor" href="#cropping-rasters-to-an-area-of-interest-"></a>
</h2>
<p>Now that we’ve got our raster and vector datasets in the same
coordinate system, we can do operations that use both datasets. Let’s
create a spatial subset of the elevation map that covers the same area
as our points. To do this we will use the <code><a href="https://rdrr.io/pkg/terra/man/crop.html" class="external-link">crop()</a></code>
function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dem_crop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">dem</span>,<span class="va">sites_proj</span><span class="op">)</span></span>
<span><span class="va">dem_crop</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 248, 273, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 3, 3  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 327279, 328098, 4313739, 4314483  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : WGS 84 / UTM zone 13N (EPSG:32613) </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; name        : UG_dem_3m_v1 </span></span>
<span><span class="co">#&gt; min value   :     2874.120 </span></span>
<span><span class="co">#&gt; max value   :     3018.812</span></span></code></pre></div>
<p>The second argument to <code><a href="https://rdrr.io/pkg/terra/man/crop.html" class="external-link">crop()</a></code> specifies the spatial
extent that we want to use to crop the raster. If we supply a vector
dataset, the default behavior is to extract the rectangular extent that
covers the vector dataset, using the <code><a href="https://rdrr.io/pkg/terra/man/ext.html" class="external-link">ext()</a></code> function behind
the scenes. Looking at the dimensions of <code>dem_crop</code>, it’s now
clear that this is a much smaller subset than the original data. It’s
also now stored in memory, so subsequent operations on this subset
should be quite fast.</p>
</div>
<div class="section level2">
<h2 id="modifying-raster-data-">Modifying raster data.<a class="anchor" aria-label="anchor" href="#modifying-raster-data-"></a>
</h2>
<p>Now that we’ve subset our raster data, we can perform lots of
different operations on it. For example, the <code><a href="https://rdrr.io/pkg/terra/man/terrain.html" class="external-link">terrain()</a></code>
function in <code>terra</code> allows us to compute the topographic
slope, identifying areas of steep terrain:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dem_slope</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/terrain.html" class="external-link">terrain</a></span><span class="op">(</span><span class="va">dem_crop</span>,<span class="st">"slope"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dem_slope</span><span class="op">)</span></span></code></pre></div>
<p><img src="wrangle-raster-data_files/figure-html/dem%20slope-1.png" width="700"></p>
<p>We can also perform arbitrary mathematical operations on the raster.
For example, if we wanted to convert the elevation map from it’s default
unit (meters) to feet, we could multiply the map by the appropriate
conversion coefficient (1 meter = 3.28084 feet).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dem_feet</span> <span class="op">&lt;-</span> <span class="va">dem_crop</span> <span class="op">*</span> <span class="fl">3.28084</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dem_crop</span>,<span class="va">dem_feet</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="wrangle-raster-data_files/figure-html/dem%20feet-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="resampling-rasters-to-a-different-grid-">Resampling rasters to a different grid.<a class="anchor" aria-label="anchor" href="#resampling-rasters-to-a-different-grid-"></a>
</h2>
<p>Often we want take raster datasets from different sources and put
them on the same grid. This operation is called <em>resampling</em>.</p>
<p>To do this, we need to define the grid of the output dataset and
choose a method for calculating the resampled values at the locations of
those grid cells. For continuous data, the most common resampling method
is called <em>bilinear interpolation</em>. This method defines the new
value of pixels as a weighted average of the values of the four closest
pixels in the source data. To put this into practice, we can use the
<code><a href="https://rdrr.io/pkg/terra/man/resample.html" class="external-link">resample()</a></code> function in the terra package.</p>
<div class="figure">
<img src="https://gisgeography.com/wp-content/uploads/2016/10/Bilinear-Interpolation-Feature-850x448.png" alt="Figure 3. Bilinear interpolation. In this resampling strategy, new raster values are computed as a weighted average of the four closest raster cells, with closer cells having higher weights." width="100%"><p class="caption">
Figure 3. Bilinear interpolation. In this resampling strategy, new
raster values are computed as a weighted average of the four closest
raster cells, with closer cells having higher weights.
</p>
</div>
<p>First, let’s load a raster dataset with a lower resolution than the
raster. This data is an estimate of the day of year that seasonal
snowpack finally melted in spring.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">snow_2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdp_get_raster.html">sdp_get_raster</a></span><span class="op">(</span><span class="st">"R4D001"</span>,years<span class="op">=</span><span class="fl">2020</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Returning yearly dataset with 1 layers..."</span></span>
<span><span class="va">snow_crop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">snow_2020</span>,<span class="va">sites_proj</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">snow_crop</span><span class="op">)</span></span></code></pre></div>
<p><img src="wrangle-raster-data_files/figure-html/load%20snow-1.png" width="700"></p>
<p>This dataset has the same coordinate system as the elevation map, but
a much lower spatial resolution. To resample the data to the finer
resolution of the elevation map, we use the <code><a href="https://rdrr.io/pkg/terra/man/resample.html" class="external-link">resample()</a></code>
function, defining the elevation map as the template:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">snow_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/resample.html" class="external-link">resample</a></span><span class="op">(</span><span class="va">snow_crop</span>,<span class="va">dem_crop</span>,method<span class="op">=</span><span class="st">"bilinear"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">snow_crop</span>,main<span class="op">=</span><span class="st">"Original (27m resolution)"</span>,range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">120</span>,<span class="fl">145</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">snow_res</span>,main<span class="op">=</span><span class="st">"Resampled (3m resolution)"</span>,range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">120</span>,<span class="fl">145</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="wrangle-raster-data_files/figure-html/resample%20raster-1.png" width="768"></p>
<p>Obviously this doesn’t create any new information at this finer
resolution. Instead, it “smooths” the original values to fit the new
finer grid. Whether this is a problem depends on whether there is a lot
of important variability in the dataset at that finer resolution.</p>
</div>
<div class="section level2">
<h2 id="re-projecting-rasters-to-a-different-coordinate-system-">Re-projecting rasters to a different coordinate system.<a class="anchor" aria-label="anchor" href="#re-projecting-rasters-to-a-different-coordinate-system-"></a>
</h2>
<p>Occasionally, we will need to translate raster data between
coordinate systems. This happens in two stages:</p>
<ol style="list-style-type: decimal">
<li>First, the center points of the original raster cells are
re-projected to the new coordinate system.</li>
<li>Then, new values are computed for the projected grid using a
resampling method like we used above.</li>
</ol>
<p>To demonstrate this, let’s load a climate dataset from an outside
source. The <code>ClimateR</code> package provides easy access to a
variety of gridded climate datasets. First we will need to install it
from GitHub:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#remotes::install_github("mikejohnson51/climateR")</span></span>
<span><span class="co">#remotes::install_github("mikejohnson51/AOI")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mikejohnson51/climateR" class="external-link">climateR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mikejohnson51/AOI/" class="external-link">AOI</a></span><span class="op">)</span></span></code></pre></div>
<p>Then we can grab an example climate map from the PRISM dataset:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="va">sites</span>,dist<span class="op">=</span><span class="fl">5000</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">buff</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">sites</span><span class="op">)</span></span>
<span><span class="va">prism</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/climateR/man/getPRISM.html" class="external-link">getPRISM</a></span><span class="op">(</span>AOI<span class="op">=</span><span class="va">buff</span>,varname<span class="op">=</span><span class="st">"tmax"</span>,startDate<span class="op">=</span><span class="st">"2020-05-01"</span>,endDate<span class="op">=</span><span class="st">"2020-05-01"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">prism</span><span class="op">$</span><span class="va">tmax</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "GEOGCRS[\"unknown\",\n    DATUM[\"unknown\",\n        ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n            LENGTHUNIT[\"metre\",1,\n                ID[\"EPSG\",9001]]]],\n    PRIMEM[\"unknown\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433,\n            ID[\"EPSG\",9122]]],\n    CS[ellipsoidal,2],\n        AXIS[\"longitude\",east,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433,\n                ID[\"EPSG\",9122]]],\n        AXIS[\"latitude\",north,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433,\n                ID[\"EPSG\",9122]]]]"</span></span></code></pre></div>
<p>In this case, the coordinate system of the raster is a geographic
(lat-long) coordinate system, but it’s different from the others we are
using. We can verify this:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">prism</span><span class="op">$</span><span class="va">tmax</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">sites</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">prism</span><span class="op">$</span><span class="va">tmax</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">sites_proj</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>This means we need to re-project the data before combining it with
the rest.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prism_proj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">prism</span><span class="op">$</span><span class="va">tmax</span>,<span class="va">dem</span>,method<span class="op">=</span><span class="st">"bilinear"</span>,align<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>This operation is quite slow, even for a relatively small raster
dataset like this one, but now we can crop the result to get a layer
with the same extent and resolution as the other layers.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prism_crop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">prism_proj</span>,<span class="va">dem_crop</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="combining-rasters-into-a-single-dataset-">Combining rasters into a single dataset.<a class="anchor" aria-label="anchor" href="#combining-rasters-into-a-single-dataset-"></a>
</h2>
<p>After all of that wrangling, we’ve finally been able to assemble a
collection of raster data with a consistent cell size and resolution. We
can combine these individual layers into a single
<code>SpatRaster</code> object using the <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> function.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">full_stack_3m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dem_crop</span>,<span class="va">dem_slope</span>,<span class="va">snow_res</span>,<span class="va">prism_crop</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">full_stack_3m</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Elevation"</span>,<span class="st">"Slope"</span>,<span class="st">"SnowPersist"</span>,<span class="st">"Tmax"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">full_stack_3m</span><span class="op">)</span></span></code></pre></div>
<p><img src="wrangle-raster-data_files/figure-html/spatraster-1.png" width="768">
This data is now “Analysis-Ready”! We can use it to extract data at our
field sites, fit spatial prediction models, and a variety of other
tasks.</p>
</div>
<div class="section level2">
<h2 id="exporting-spatial-data">Exporting spatial data<a class="anchor" aria-label="anchor" href="#exporting-spatial-data"></a>
</h2>
<p>If we want to explore our wrangled data, we will often want to do
that in a GIS program like QGIS. Exporting the data to disk allows us to
do this:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">full_stack_3m</span>,<span class="st">"~/Downloads/wrangled_raster_data.tif"</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>This will write a single file to disk with four layers representing
the different raster datasets that we wrangled. Specifying a “.tif” file
extension writes the file to geoTIFF format, the most commonly used
raster file format.</p>
<p>We can do something similar for the wrangled vector data using the
<code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read()</a></code> function in <code>sf</code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">sites_proj</span>,<span class="st">"~/Downloads/wrangled_point_data.geojson"</span>, delete_dsn<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Deleting source `/Users/ian/Downloads/wrangled_point_data.geojson' using driver `GeoJSON'</span></span>
<span><span class="co">#&gt; Writing layer `wrangled_point_data' to data source </span></span>
<span><span class="co">#&gt;   `/Users/ian/Downloads/wrangled_point_data.geojson' using driver `GeoJSON'</span></span>
<span><span class="co">#&gt; Writing 9 features with 2 fields and geometry type Point.</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Ian Breckheimer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
